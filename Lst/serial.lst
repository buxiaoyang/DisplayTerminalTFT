C51 COMPILER V7.50   SERIAL                                                                02/19/2014 15:20:30 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE SERIAL
OBJECT MODULE PLACED IN .\Obj\serial.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Src\serial.c COMPACT BROWSE INCDIR(.\Src) DEBUG OBJECTEXTEND PRINT(.\Lst\se
                    -rial.lst) OBJECT(.\Obj\serial.obj)

line level    source

   1          /************************************************************/
   2          /*项目：DisplayTerminalTFT
   3          /*模块：串口模块
   4          /*日期：2014年2月17日
   5          /*修改：卜晓D
   6          /************************************************************/
   7          
   8          #include "reg52stc.h"
   9          #include "serial.h"
  10          
  11          
  12          /******************** 显示数据缓存 *******************/
  13          
  14          //年     月  日  时      分       状态  服务  cpu    内存    上传      下载      温度    IP地址
  15          //0123   45      67      9 10  12 13       15    17       19 20  22 23  25 26 27   29 30 31      33 34   36~50
  16          uchar DisplayData[] = "20140219,13:26,N,N,45,64,034,089,13,192.168.025.001";
  17          //数据格式 DATA20140219,13:26,N,N,45,64,034,089,13,192.168.025.001END
  18          
  19          /******************** 全局变量定义 *******************/
  20          uchar get_i=0;  //读取数据的计数
  21          uchar LenToSend=0;
  22          uint DataToSend;
  23          #define    RELOAD_COUNT    0xe6    //12MHz,0xf3, 12T,SMOD=0,2400bps; 24MHz 0xe6
  24          #define    Self_Define_ISP_Download_Command    0x7f
  25          
  26          /******************** 延迟函数ms *******************/
  27          void delayms(uint tt)
  28          {
  29   1          uchar i;
  30   1              uchar j;
  31   1          while(tt>0)
  32   1          {
  33   2              tt--;
  34   2              for(j=0;j<5;j++)
  35   2                  {
  36   3                          for(i=0;i<168;i++)
  37   3                              {
  38   4                              }
  39   3              }
  40   2          }
  41   1      }
  42          
  43          /******************** 软复位函数 *******************/
  44          void soft_reset_to_ISP_Monitor(void)
  45          {
  46   1              IAP_CONTR = 0x60;   //0110，0000  软复位到系统ISP监控区
  47   1      }
  48          
  49          /******************** 串口接收中断函数 *******************/
  50          void UART_Interrupt_Receive(void) interrupt 4 //using 1
  51          {
  52   1              uchar k;
  53   1              if(RI==1)
  54   1              {
C51 COMPILER V7.50   SERIAL                                                                02/19/2014 15:20:30 PAGE 2   

  55   2                      RI = 0;
  56   2                      k = SBUF;
  57   2                      if((k==Self_Define_ISP_Download_Command)||(0x1f==k))        //是自定义下载命令
  58   2                      {
  59   3                              get_i++;
  60   3                              if (10==get_i)
  61   3                              {
  62   4                                      delayms(200); //zxy
  63   4                                      soft_reset_to_ISP_Monitor();    //软复位到系统ISP监控区
  64   4                              }
  65   3                      }
  66   2                      else
  67   2                      {
  68   3                              if ((0==TI)&&(0==LenToSend))
  69   3                              {
  70   4                                      SBUF=0xa5;  //Serial OK !!!
  71   4                              }
  72   3                              get_i=0;
  73   3                      }
  74   2              }
  75   1              else
  76   1              {
  77   2                      TI = 0;
  78   2                      if (0!=LenToSend)
  79   2                      {
  80   3                              LenToSend--;
  81   3                              if (0==LenToSend)
  82   3                                      SBUF=DataToSend>>8;
  83   3                              else
  84   3                                      SBUF=DataToSend;
  85   3                      }
  86   2              }
  87   1      }
  88          
  89          /******************** 串口发送函数 *******************/
  90          void SerialSend(uint Data, uchar Len)
  91          {
  92   1              if (0==TI)
  93   1              {
  94   2                      SBUF=Data;
  95   2                      Len--;
  96   2              }
  97   1              LenToSend=Len;
  98   1              DataToSend=Data;
  99   1      }
 100          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    162    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     56    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
