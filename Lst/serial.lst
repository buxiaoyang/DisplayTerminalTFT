C51 COMPILER V7.50   SERIAL                                                                02/18/2014 21:12:47 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE SERIAL
OBJECT MODULE PLACED IN .\Obj\serial.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Src\serial.c BROWSE INCDIR(.\Src) DEBUG OBJECTEXTEND PRINT(.\Lst\serial.lst
                    -) OBJECT(.\Obj\serial.obj)

line level    source

   1          /************************************************************/
   2          /*项目：DisplayTerminalTFT
   3          /*模块：串口模块
   4          /*日期：2014年2月17日
   5          /*修改：卜晓D
   6          /************************************************************/
   7          
   8          #include "reg52stc.h"
   9          #include "serial.h"
  10          
  11          /******************** 全局变量定义 *******************/
  12          uchar get_i=0;  //读取数据的计数
  13          uchar LenToSend=0;
  14          uint DataToSend;
  15          #define    RELOAD_COUNT    0xe6    //12MHz,0xf3, 12T,SMOD=0,2400bps; 24MHz 0xe6
  16          #define    Self_Define_ISP_Download_Command    0x7f
  17          
  18          /******************** 延迟函数ms *******************/
  19          void delayms(uint tt)
  20          {
  21   1          uchar i;
  22   1              uchar j;
  23   1          while(tt>0)
  24   1          {
  25   2              tt--;
  26   2              for(j=0;j<5;j++)
  27   2                  {
  28   3                          for(i=0;i<168;i++)
  29   3                              {
  30   4                              }
  31   3              }
  32   2          }
  33   1      }
  34          
  35          /******************** 软复位函数 *******************/
  36          void soft_reset_to_ISP_Monitor(void)
  37          {
  38   1              IAP_CONTR = 0x60;   //0110，0000  软复位到系统ISP监控区
  39   1      }
  40          
  41          /******************** 串口接收中断函数 *******************/
  42          void UART_Interrupt_Receive(void) interrupt 4 //using 1
  43          {
  44   1              uchar k;
  45   1              if(RI==1)
  46   1              {
  47   2                      RI = 0;
  48   2                      k = SBUF;
  49   2                      if((k==Self_Define_ISP_Download_Command)||(0x1f==k))        //是自定义下载命令
  50   2                      {
  51   3                              get_i++;
  52   3                              if (10==get_i)
  53   3                              {
  54   4                                      delayms(200); //zxy
C51 COMPILER V7.50   SERIAL                                                                02/18/2014 21:12:47 PAGE 2   

  55   4                                      soft_reset_to_ISP_Monitor();    //软复位到系统ISP监控区
  56   4                              }
  57   3                      }
  58   2                      else
  59   2                      {
  60   3                              if ((0==TI)&&(0==LenToSend))
  61   3                              {
  62   4                                      SBUF=0xa5;  //Serial OK !!!
  63   4                              }
  64   3                              get_i=0;
  65   3                      }
  66   2              }
  67   1              else
  68   1              {
  69   2                      TI = 0;
  70   2                      if (0!=LenToSend)
  71   2                      {
  72   3                              LenToSend--;
  73   3                              if (0==LenToSend)
  74   3                                      SBUF=DataToSend>>8;
  75   3                              else
  76   3                                      SBUF=DataToSend;
  77   3                      }
  78   2              }
  79   1      }
  80          
  81          /******************** 串口发送函数 *******************/
  82          void SerialSend(uint Data, uchar Len)
  83          {
  84   1              if (0==TI)
  85   1              {
  86   2                      SBUF=Data;
  87   2                      Len--;
  88   2              }
  89   1              LenToSend=Len;
  90   1              DataToSend=Data;
  91   1      }
  92          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    144    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
