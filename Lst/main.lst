C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Obj\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Src\main.c BROWSE INCDIR(.\Src) DEBUG OBJECTEXTEND PRINT(.\Lst\main.lst) OB
                    -JECT(.\Obj\main.obj)

line level    source

   1          //******************************************************************
   2          //  CPU:STC11L60XE
   3          //  CRY:11.0592Mhz
   4          //  LCM:s6d0154-2.6 TFT
   5          //  PCB:v1
   6          //  NAM:彩屏程序                                            20120906
   7          //******************************************************************
   8          //#include <REG54.H>
   9          //#include <reg51.h>
  10          #include "STC_NEW_8051.H"
  11          #define uchar unsigned char
  12          #define uint unsigned int
  13          
  14          #include "HEAD.H"
  15          
  16          //#include"init_tft.h"
  17          #include"s6d0154_drv.h"
  18          #include "SD_MMC.h"
  19          #include "FAT3216.h"
  20          #include "showimg51.h"
  21          
  22          //---------------------------------
  23          #define T0_H 0xF8 //0xFC  1ms from 12MHz 998 to 24MHz 1998
  24          #define T0_L 0x32 //0x1A
  25          #define T1_H 0xfe
  26          #define T1_L 0x31
  27          #include "serial.h" //串口功能
  28          #include "SysTem.H"
  29          extern unsigned char xdata Buffer[512];
  30          
  31          //****************************************************************
  32          //  延时1ms程序
  33          //****************************************************************
  34          //           fosc=12MHz;count=10;j=5, i=62; Keil uV2=9.977ms
  35          //STC12c4042:fosc=12Mhz;count=1; j=10,i=169;KEIL750 =1.000ms!!!不准!!!实际长了
  36          //STC12c5410AD:内置5.756373M;count=10;j=10,i=78;KEIL750=10.000ms!
  37          void Delay(unsigned int count)// delay=1ms*count 12MHz with 11L60XE
  38          {
  39   1          unsigned char i,j;
  40   1          while(count--!=0)
  41   1          {   for(j=0;j<10;j++)
  42   2                  {    for(i=0;i<168;i++);
  43   3      }   }   }
  44          //******************************************************************
  45          //  在TFT上显示字符
  46          //------------------------------------------------------------------
  47          void ViewTFT(void)
  48          {
  49   1          LCD_CS =0;  //打开片选使能
  50   1          //---------------------------------
  51   1          ChineseChar(14+46,10,2,colors[2],colors[7],1);      //晶
  52   1          ChineseChar(46+46,10,2,colors[2],colors[7],2);      //液
  53   1          ChineseChar(78+46,10,2,colors[2],colors[7],3);      //心
  54   1          ChineseChar(110+46,10,2,colors[2],colors[7],4);     //伤
C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 2   

  55   1              //---------------------------------
  56   1          ChineseChar( 0,50,1,colors[0],colors[7],1);     //靠
  57   1          ChineseChar(24,50,1,colors[0],colors[7],2);     //!
  58   1          
  59   1          ChineseChar( 48,50,1,colors[1],colors[7],3);    //
  60   1          ChineseChar( 72,50,1,colors[2],colors[7],4);    //
  61   1          ChineseChar( 96,50,1,colors[3],colors[2],5);    //
  62   1          ChineseChar(120,50,1,colors[4],colors[7],6);        //
  63   1          ChineseChar(144,50,1,colors[5],colors[7],7);        //
  64   1          ChineseChar(168,50,1,colors[6],colors[7],8);        //
  65   1          ChineseChar(192,50,1,colors[5],colors[2],9);        //片
  66   1              //---------------------------------
  67   1          ChineseChar( 0,75,1,colors[4],colors[7],10);    //
  68   1              ChineseChar(24,75,1,colors[4],colors[7],11);    //
  69   1              ChineseChar(48,75,1,colors[6],colors[7],12);    //
  70   1              ChineseChar(72,75,1,colors[6],colors[7],13);    //
  71   1              
  72   1              ChineseChar( 96,75,1,colors[2],colors[7],14);   //
  73   1              ChineseChar(120,75,1,colors[2],colors[7],15);   //
  74   1              ChineseChar(144,75,1,colors[2],colors[7],16);   //
  75   1              ChineseChar(168,75,1,colors[4],colors[7],17);   //
  76   1              ChineseChar(192,75,1,colors[4],colors[7],18);   //
  77   1              //---------------------------------
  78   1          ChineseChar( 0,100,1,colors[4],colors[7],19);   //
  79   1              ChineseChar(24,100,1,colors[5],colors[2],20);   //
  80   1              ChineseChar(48,100,1,colors[5],colors[2],21);   //
  81   1              ChineseChar(72,100,1,colors[5],colors[2],22);   //
  82   1              
  83   1              ChineseChar( 96,100,1,colors[2],colors[7],23);  //
  84   1              ChineseChar(120,100,1,colors[2],colors[7],24);  //
  85   1              ChineseChar(144,100,1,colors[2],colors[7],25);  //
  86   1              ChineseChar(168,100,1,colors[4],colors[7],26);  //
  87   1              ChineseChar(192,100,1,colors[4],colors[7],27);  //
  88   1              //---------------------------------
  89   1          ChineseChar( 0,125,1,colors[4],colors[7],28);   //
  90   1              ChineseChar(24,125,1,colors[1],colors[7],29);   //
  91   1              ChineseChar(48,125,1,colors[2],colors[7],30);   //
  92   1              ChineseChar(72,125,1,colors[3],colors[2],31);   //
  93   1              
  94   1              ChineseChar( 96,125,1,colors[2],colors[7],32);  //?
  95   1              //---------------------------------
  96   1          
  97   1          //LCD_ShowString(12,60,colors[0],colors[7],"-");
  98   1          //LCD_ShowString(0,90,colors[0],colors[5],"WWW.PRINTER.com");
  99   1          //LCD_ShowString(216,120,colors[4],colors[7],":");
 100   1          
 101   1              LCD_ShowString(0,150,colors[7],colors[2],"www.s6d0154.com");//www.s6d0154.com.net若超出字符不予显示
 102   1          //LCD_ShowString(12,180,colors[0],colors[7],"TELL:");
 103   1          
 104   1          LCD_ShowString(0,174,colors[2],colors[7],"T: 010-12345678");        
 105   1          LCD_ShowString(0,198,colors[2],colors[7],"abcdefJhiJKLMNOP"); 
 106   1          LCD_ShowString(0,222,colors[2],colors[7],"pqrstuvwxyz!@#$"); 
 107   1          LCD_ShowString(0,246,colors[2],colors[7],"<>CDEF^&*()/,[]");
 108   1          //---------------------------------
 109   1              LCD_CS =1;  //关闭片选使能
 110   1      }
 111          
 112          void TestDelay(uchar timer)
 113          {
 114   1      //  uint DelayTime;
 115   1      
 116   1        etx0=0;
C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 3   

 117   1        TH0=T0_H;
 118   1        TL0=T0_L;
 119   1        if (1==timer)
 120   1        {
 121   2          TR0=1;
 122   2          Delay(1);
 123   2          TR0=0;
 124   2        }
 125   1        else
 126   1        {
 127   2          TR0=1;
 128   2          delayms(1);
 129   2          TR0=0;
 130   2        }
 131   1      //  DelayTime=(TH0<<8)|TL0;
 132   1        SerialSend(etx0,2);
 133   1      }
 134          
 135          unsigned int etx0;
 136          uchar idata Display[16]={0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
 137                             0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00};
 138          void HEXtoASC(uint HEX, uchar index)
 139          {
 140   1        uchar i;// temp;
 141   1        index +=4;
 142   1        Display[index]=0;
 143   1        for (i=4;i!=0;i--)
 144   1        {
 145   2          index--;
 146   2          Display[index]=(HEX%10)+'0';
 147   2              HEX/=10;
 148   2        }
 149   1      /*      if (4==i)
 150   1                temp=HEX>>12;
 151   1          else if (3==i)
 152   1                temp=HEX>>8;
 153   1          else if (2==i)
 154   1                temp=((uchar)HEX)>>4;
 155   1              else
 156   1                temp=HEX;
 157   1              temp&=0x0f;
 158   1              if (temp>9)
 159   1                Display[index]=temp+'A'-10;
 160   1              else
 161   1                Display[index]=temp+'0';
 162   1              index++;
 163   1        }*/
 164   1      }
 165          
 166          //******************************************************************
 167          //  主程序
 168          //------------------------------------------------------------------
 169          void main(void)
 170          {
 171   1          uchar res;
 172   1              uchar count;
 173   1      
 174   1          LCD_Init();
 175   1              InitSys();//初始化timer/serial-isp
 176   1          //---------------------------------
 177   1          res=SD_init();                  //SD卡初始化
 178   1          /*
C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 4   

 179   1                  //---------------------------------
 180   1                  Pant(0xff,0xff);  //TFT清屏
 181   1                  Delay(100);
 182   1                  //---------------------------------
 183   1                  Display_Image();
 184   1                  Delay(2000);
 185   1                  //while(1);
 186   1          */
 187   1                  ViewTFT();          //在TFT上显示字符
 188   1                  Delay(1000);
 189   1                  //while(1);
 190   1          if (!res) res=Get_disk_info();            //获取FAT32文件系统参数
 191   1      //        Display_Red();
 192   1              Delay(1000);
 193   1          while(1)
 194   1          {
 195   2      #define TXT 0
 196   2      #define BIN 3            
 197   2            if (!res) res=Scan_file(200,TXT);
 198   2      //        Display_Green();
 199   2              Delay(500);
 200   2            if (!res) res=Readfile();
 201   2                if (!res)
 202   2                {
 203   3                  LCD_CS =0;  //打开片选使能
 204   3                  LCD_ShowString(0,296,colors[0],colors[4],Buffer);
 205   3                  LCD_CS =1;  //关闭片选使能
 206   3                }
 207   2            Delay(2000);
 208   2            count     = 0;
 209   2            do
 210   2                {
 211   3                  if (!res) res=Scan_file(count,BIN);
 212   3              if (!res) 
 213   3                  {
 214   4                Delay(500);
 215   4                  etx0=0;
 216   4                  TH0=T0_H;
 217   4                  TL0=T0_L;
 218   4                  TR0=1;
 219   4                    Show_TFImage();    //显示图片240*320
 220   4                  TR0=0;
 221   4                          HEXtoASC(etx0, 0);
 222   4                              Display[4]='m';
 223   4                              Display[5]='s';
 224   4                              Display[6]=0;
 225   4                  LCD_CS =0;  //打开片选使能
 226   4                Delay(3000);
 227   4                        LCD_ShowString(0,296,colors[7],colors[4],Display);
 228   4                  }
 229   3                  count++;
 230   3                }while (!res);
 231   2                res=0;
 232   2              }
 233   1          while(1)
 234   1          {
 235   2              Display_White();
 236   2              Delay(400);
 237   2              Display_Black();
 238   2              Delay(400);
 239   2      
 240   2              etx0=0;
C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 5   

 241   2              TH0=T0_H;
 242   2              TL0=T0_L;
 243   2              TR0=1;
 244   2              Display_Red();
 245   2              TR0=0;
 246   2      //        DelayTime=(etx0<<8);
 247   2      //              DelayTime|=(etx0>>8);
 248   2              SerialSend(etx0,2);
 249   2                      HEXtoASC(etx0, 0);
 250   2              Delay(400);
 251   2      
 252   2              Display_Green();
 253   2              Delay(400);
 254   2              Display_Blue();
 255   2              Delay(400);
 256   2      
 257   2              etx0=0;
 258   2              TH0=T0_H;
 259   2              TL0=T0_L;
 260   2              TR0=1;
 261   2              Pant(0x0,0x0);    //TFT黑色清屏
 262   2              TR0=0;
 263   2      //        DelayTime=(etx0<<8);
 264   2      //              DelayTime|=(etx0>>8);
 265   2              SerialSend(etx0,2);
 266   2                      HEXtoASC(etx0, 5);
 267   2              Delay(400);
 268   2              //---------------------------------
 269   2      //        while(1)
 270   2              {
 271   3                  Pant(0xff,0xff);    //TFT白色清屏
 272   3                  Delay(400);
 273   3                  etx0=0;
 274   3                  TH0=T0_H;
 275   3                  TL0=T0_L;
 276   3                  TR0=1;
 277   3                  Show_ROMImage();    //显示图片240*80
 278   3                  TR0=0;
 279   3      //            DelayTime=(etx0<<8);
 280   3      //                      DelayTime|=(etx0>>8);
 281   3                  SerialSend(etx0,2);
 282   3                          HEXtoASC(etx0, 10);
 283   3      //                  Display[4]=Buffer[0];
 284   3      //                  Display[9]=Buffer[1];
 285   3      //                  Display[14]=Buffer[3];
 286   3                  LCD_CS =0;  //打开片选使能
 287   3                  LCD_ShowString(0,296,colors[7],colors[4],Display);
 288   3                  LCD_CS =1;  //关闭片选使能
 289   3                  Delay(3000);
 290   3                  //---------------------------------
 291   3      //            Pant(0xff,0xff);  //不清屏的话就在上幅Image上覆盖
 292   3      //            Delay(500);
 293   3                              TestDelay(1);
 294   3                  ViewTFT();          //在TFT上显示字符
 295   3                  Delay(2000);
 296   3                          TestDelay(2);
 297   3              }
 298   2          }
 299   1      }
 300          //while(1){Delay(500);PWM0=~PWM0;}
 301          //******************************************************************
 302          //  
C51 COMPILER V7.50   MAIN                                                                  02/15/2014 14:32:11 PAGE 6   

 303          //------------------------------------------------------------------
 304          
 305          //---------------------------------
 306          
 307          //******************************************************************
 308          //  
 309          //------------------------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1633    ----
   CONSTANT SIZE    =     81    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =     16    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
